schemaVersion: 2.0.0
metadata:
  name: java-openliberty-custom
  version: 0.0.1
  description: Java application stack using Open Liberty runtime and Java Version 8 on Ubuntu
  alpha.build-dockerfile: "file://./assets/outter-loop/Dockerfile"
  alpha.deployment-manifest: "https://raw.githubusercontent.com/OpenLiberty/application-stack/master/outer-loop/latest/app-deploy.yaml"
parent:
  uri: https://raw.githubusercontent.com/OpenLiberty/application-stack/master/devfile.yaml
  components:
     - name: devruntime
       container:
         image: <custom-base-ol-stack-image-name>
  commands:
    - id: build
      exec:  
        component: devruntime 
        commandLine:  if [ -e /projects/.disable-bld-cmd ];
                      then
                        echo "found the disable file" && echo "devBuild command will not run" && exit 0;
                      else
                        echo "will run the devBuild command" && mkdir -p /projects/target/liberty
                                                             && if [ ! -d /projects/target/liberty/wlp ];
                                                                  then echo "...moving liberty"; mv /opt/ol/wlp /projects/target/liberty; touch ./.liberty-mv;
                                                                elif [[ -d /projects/target/liberty/wlp && ! -e /projects/.liberty-mv ]];
                                                                  then echo "STACK WARNING - LIBERTY RUNTIME WAS LOADED FROM HOST";
                                                                fi
                                                             && mvn -Dliberty.runtime.version=<cutom-liberty-version> -Dmaven.compiler.target=<custom-java-compiler-level> -Dmaven.compiler.source=<custom-java-compiler-level> package
                                                             && touch ./.disable-bld-cmd;
                      fi
    - id: run
      exec:
        component: devruntime 
        commandLine: mvn -Dliberty.runtime.version=<cutom-liberty-version> -Dmaven.compiler.target=<custom-java-compiler-level> -Dmaven.compiler.source=<custom-java-compiler-level> -Ddebug=false -DhotTests=true -DcompileWait=3 liberty:dev
    - id: run-test-off
      exec:
        component: devruntime
        commandLine: mvn -Dliberty.runtime.version=<cutom-liberty-version> -Dmaven.compiler.target=<custom-java-compiler-level> -Dmaven.compiler.source=<custom-java-compiler-level> -Ddebug=false liberty:dev
    - id: debug
      exec:
        component: devruntime 
        commandLine: mvn -Dliberty.runtime.version=<cutom-liberty-version> -Dmaven.compiler.target=<custom-java-compiler-level> -Dmaven.compiler.source=<custom-java-compiler-level> -DdebugPort=${DEBUG_PORT} liberty:dev -Dliberty.env.WLP_DEBUG_REMOTE=y
    - id: test
      exec:
        component: devruntime 
        commandLine: mvn Dliberty.runtime.version=<cutom-liberty-version> -Dmaven.compiler.target=<custom-java-compiler-level> -Dmaven.compiler.source=<custom-java-compiler-level> -Dmicroshed_hostname=localhost -Dmicroshed_http_port=9080 -Dmicroshed_manual_env=true -Dmicroshed_app_context_root=/ failsafe:integration-test
